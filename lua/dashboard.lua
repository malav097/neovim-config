-- lua/config/startmessage.lua
local group = vim.api.nvim_create_augroup('StartMessageDashboard', { clear = true })

vim.api.nvim_create_autocmd('VimEnter', {
  group = group,
  callback = function()
    -- Only when launched without files/stdin
    if vim.fn.argc() ~= 0 or vim.fn.line2byte '$' ~= -1 then
      return
    end

    -- Create an unlisted scratch buffer (like dashboards do)
    local buf = vim.api.nvim_create_buf(false, true) -- listed=false, scratch=true
    vim.api.nvim_set_current_buf(buf)

    -- Buffer/window options so :wqa! never complains
    vim.bo[buf].buftype = 'nofile'
    vim.bo[buf].bufhidden = 'wipe'
    vim.bo[buf].swapfile = false
    vim.bo[buf].filetype = 'startscreen'
    vim.bo[buf].modifiable = true

    vim.wo.number = false
    vim.wo.relativenumber = false
    vim.wo.signcolumn = 'no'
    vim.wo.list = false
    vim.wo.cursorline = false

    -- Replace the old `local lines = { ... }` with this:
    local art = [[
...............................................................................
...............................................................................
...............................................................................
...............................###########.....................................
...........................###............#..######............................
........................##............................#+##.....................
....................###.....................................###................
.................###......................................##..#................
..............#+.......................................##+....#................
............######+.................................###.......#................
............#...........+######+.................###..........#................
............#.....................#-.#####.....##.............#................
............#................................#................#................
............#.........-......................#................#................
............+......##....#+.......####-......#................#................
............#.....#-......#.....##.....#.....#-..............##................
............#....##..##+..+#...##.......#....#...............##................
............#....+-.-###..#....#..####.##....#...............##................
............#.....#......#.....##.#-#..#.....................#+................
............#......######.......##...##-.....................##................
............#.....................-##........-................#................
............#................................#................#................
............#..........#########.............#................#................
............#.......###..........##..........#................#................
............+#.....##..............##........#..............###................
............-#....##................##.......#...........###...................
.............#.......................#-......#..........##.....................
.............#...............................#......-#+........................
.............#######.........................#....###..........................
.......................+#.##+##..............#..##.............................
..................................######+....###...............................
...........................................###.................................
...............................................................................
...............................................................................
...............................................................................
............._  _ _  _ _ _  _    ____ ____ _  _ ____ _ ____....................
.............|\ | |  | | |\/|    |    |  | |\ | |___ | | __....................
.............| \|  \/  | |  |    |___ |__| | \| |    | |__]....................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
]]

    local lines = vim.split(art, '\n', { plain = true })

    -- Your message
    --  local lines = {
    --    '',
    --    '  ðŸš€ Welcome to Neovim!',
    --    '  Happy hacking âœ¨',
    --    '',
    --    "  (This is a scratch dashboard buffer; :wqa! won't try to write it.)",
    --  }
    vim.api.nvim_buf_set_lines(buf, 0, -1, false, lines)
    -- === make the art pink ===
    vim.opt.termguicolors = true
    local ns = vim.api.nvim_create_namespace 'StartscreenArt'
    vim.api.nvim_set_hl(0, 'StartscreenArtPink', { fg = '#ff69b4' }) -- hot pink
    for i = 0, #lines - 1 do
      vim.api.nvim_buf_add_highlight(buf, ns, 'StartscreenArtPink', i, 0, -1)
    end

    -- Lock it down like dashboards
    vim.bo[buf].modifiable = false
    vim.bo[buf].readonly = true
    vim.bo[buf].modified = false -- <- crucial so :wqa! doesn't complain
    -- === OPEN NEO-TREE WITH THE DASHBOARD ===
    -- Use the API to avoid race conditions; works because you set lazy=false for neo-tree.
    pcall(function()
      require('neo-tree.command').execute {
        action = 'show', -- or 'reveal' if you want to jump to current file when there is one
        position = 'left',
        source = 'filesystem',
        dir = vim.loop.cwd(),
      }
    end)
  end,
})
